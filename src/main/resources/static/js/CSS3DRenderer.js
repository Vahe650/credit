THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(){var r,n,s,l;console.log("THREE.CSS3DRenderer",THREE.REVISION);var p=new THREE.Matrix4,d={camera:{fov:0,style:""},objects:new WeakMap},c=document.createElement("div");c.style.overflow="hidden",this.domElement=c;var m=document.createElement("div");m.style.WebkitTransformStyle="preserve-3d",m.style.transformStyle="preserve-3d",c.appendChild(m);var E=/Trident/i.test(navigator.userAgent);function S(e){return Math.abs(e)<1e-10?0:e}function h(e){var t=e.elements;return"matrix3d("+S(t[0])+","+S(-t[1])+","+S(t[2])+","+S(t[3])+","+S(t[4])+","+S(-t[5])+","+S(t[6])+","+S(t[7])+","+S(t[8])+","+S(-t[9])+","+S(t[10])+","+S(t[11])+","+S(t[12])+","+S(-t[13])+","+S(t[14])+","+S(t[15])+")"}function u(e,t){var r=e.elements,n="matrix3d("+S(r[0])+","+S(r[1])+","+S(r[2])+","+S(r[3])+","+S(-r[4])+","+S(-r[5])+","+S(-r[6])+","+S(-r[7])+","+S(r[8])+","+S(r[9])+","+S(r[10])+","+S(r[11])+","+S(r[12])+","+S(r[13])+","+S(r[14])+","+S(r[15])+")";return E?"translate(-50%,-50%)translate("+s+"px,"+l+"px)"+t+n:"translate(-50%,-50%)"+n}this.getSize=function(){return{width:r,height:n}},this.setSize=function(e,t){s=(r=e)/2,l=(n=t)/2,c.style.width=e+"px",c.style.height=t+"px",m.style.width=e+"px",m.style.height=t+"px"};var a,o,v=(a=new THREE.Vector3,o=new THREE.Vector3,function(e,t){return a.setFromMatrixPosition(e.matrixWorld),o.setFromMatrixPosition(t.matrixWorld),a.distanceToSquared(o)});function f(e){for(var t,r,n=(t=e,r=[],t.traverse(function(e){e instanceof THREE.CSS3DObject&&r.push(e)}),r).sort(function(e,t){return d.objects.get(e).distanceToCameraSquared-d.objects.get(t).distanceToCameraSquared}),a=n.length,o=0,i=n.length;o<i;o++)n[o].element.style.zIndex=a-o}this.render=function(e,t){var r=t.projectionMatrix.elements[5]*l;if(d.camera.fov!==r&&(t.isPerspectiveCamera&&(c.style.WebkitPerspective=r+"px",c.style.perspective=r+"px"),d.camera.fov=r),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.isOrthographicCamera)var n=-(t.right+t.left)/2,a=(t.top+t.bottom)/2;var o=t.isOrthographicCamera?"scale("+r+")translate("+S(n)+"px,"+S(a)+"px)"+h(t.matrixWorldInverse):"translateZ("+r+"px)"+h(t.matrixWorldInverse),i=o+"translate("+s+"px,"+l+"px)";d.camera.style===i||E||(m.style.WebkitTransform=i,m.style.transform=i,d.camera.style=i),function e(t,r,n){if(t instanceof THREE.CSS3DObject){var a;a=t instanceof THREE.CSS3DSprite?(p.copy(r.matrixWorldInverse),p.transpose(),p.copyPosition(t.matrixWorld),p.scale(t.scale),p.elements[3]=0,p.elements[7]=0,p.elements[11]=0,p.elements[15]=1,u(p,n)):u(t.matrixWorld,n);var o=t.element,i=d.objects.get(t);if(void 0===i||i.style!==a){o.style.WebkitTransform=a;var s={style:o.style.transform=a};E&&(s.distanceToCameraSquared=v(r,t)),d.objects.set(t,s)}o.parentNode!==m&&m.appendChild(o)}for(var l=0,c=t.children.length;l<c;l++)e(t.children[l],r,n)}(e,t,o),E&&f(e)}};